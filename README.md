# Angel Memory - 动态认知循环与自适应记忆演化系统

> **认知成长一体化**的AI系统：生成、维护、使用三位一体，让AI在使用中进化，在对话中成长

## 🌟 什么是Angel Memory？

Angel Memory **动态认知循环**的革命性系统，突破了传统记忆系统的"存储-检索"死模式，开创了"使用即创建、回忆即进化"的活模式：

- **🌟 认知成长一体化**：生成、维护、使用三位一体，每次对话都是认知进化
- **🔄 自适应记忆演化**：记忆网络实时重构，使用频率决定记忆强度
- **⚡ 情景化顿悟机制**：AI在对话场景中产生"开窍时刻"，硬塞知识变活认知
- **🧠 双轨动态协同**：记忆轨道与笔记轨道同步演进，创造1+1>2的涌现智能

想象一下，你在跟一个真正聪明的人聊天：
- **TA记得你们说过什么**（基于长短期记忆的混合检索）
- **TA看过海量资料但需要思考才懂**（高精度向量知识库）
- **TA会在聊天中突然"开窍"**（情景化理解与认知顿悟）

这就是Angel Memory的核心：**超越传统信息存储，实现AI真正的认知进化**！

### 🎯 精妙的设计理念

**填鸭式教育 + 开窍式成长**：
- 先把资料"硬塞"进AI的向量数据库（像背书）
- AI在具体对话中重新理解这些资料（像开窍）
- 理解了的内容就变成真正的记忆（知识内化）

**双轨并行召回**：
- **记忆轨道**：AI已经理解的内化知识
- **笔记轨道**：AI看过但还没完全理解的内容
- 两条轨道同时工作，在筛选阶段汇合

### 核心特性

- **🧠 会成长的记忆**：AI在聊天中不断产生新理解
- **📚 智能知识库**：支持多种文档，投喂即学习
- **🔄 活的认知系统**：每次对话都可能产生顿悟时刻
- **⚡ 开箱即用**：无需复杂配置，默认即可工作
- **🎯 精准高效**：双系统协同，既有深度又有广度

## 🏗️ 系统架构

### AI的大脑是怎么工作的？

```
AI的大脑就像人一样，分三层：

用户发来消息
    ↓
潜意识（DeepMind）开始工作
    ├── 左手：记忆轨道（已经理解的内容）
    │   └── 找出真正懂的相关知识
    ├── 右手：笔记轨道（硬塞的知识）
    │   └── 搜索相关资料并尝试理解
    └── 汇合点：制造"开窍时刻"
        └── 突然理解了某个知识点！
    ↓
主意识（LLM）获得认知包
    └── 结合记忆和理解，给出更好的回答
```

### 潜意识的四步工作法

**AI的"思考过程"**：观察 → 回忆 → 反馈 → 睡觉

1. **观察**：看看用户说了什么，值得一记吗？
2. **回忆**：双轨并行找资料，可能会有顿悟
3. **反馈**：把有用的内容给主意识参考
4. **睡觉**：定期整理，把重要内容固化为认知

### 🤖 主动子代理架构

**DeepMind不是被动工具，而是自主运行的智能子代理**：

不同于传统插件等着主意识发号施令，DeepMind是一个**主动的、自主的智能子代理**：

- **🎯 自主判断**：自己判断什么消息值得处理，不需要主意识提醒
- **🧠 自主决策**：自己决定检索哪些记忆、理解哪些笔记，独立思考
- **⚡ 自主执行**：自己组织认知包、更新记忆网络，主动工作
- **🔄 自然涌现**：无需任何指令，认知循环自动运行，智能自然涌现

**主动 vs 被动的根本区别**：
- **被动工具**：你调用它，它才工作，像个计算器
- **主动子代理**：它在后台默默工作，像个真正的思维伙伴

**为什么这样设计？这解放了主意识**：
- 主模型专注推理对话，不用分心管理记忆
- 潜意识自主进化，AI越用越聪明
- 分工合作，效率倍增，实现1+1>2的涌现智能

这就是**革命性的子代理架构**：AI拥有了真正的"潜意识"，能够自主思考、自主进化！

### 为什么这样设计？

**抓住了人类学习的本质**：
- 人也不是一下子就懂所有东西
- 很多知识需要"用到才开窍"
- 记忆和理解是两个不同但相关的过程
- 认知成长是动态的，不是静态存储

### 知识库系统特性

- **多格式支持**：PDF、Word、PPT、Excel、Markdown、文本等
- **智能解析**：自动提取文档结构和关键信息
- **语义检索**：基于内容语义的智能匹配
- **动态索引**：文件变化自动同步更新

## 📋 安装与配置

### ⚠️ 前置依赖要求

**必须安装 [astrbot_plugin_angel_heart](https://github.com/kawayiYokami/astrbot_plugin_angel_heart) 插件**

> AstrBot 原生聊天记录管理功能无法满足记忆系统需求，必须使用天使之心插件提供的增强聊天记录管理能力。

### 快速安装

1. **安装前置插件**
   ```bash
   # 在 AstrBot plugins 目录中安装天使之心插件
   ```

2. **安装记忆插件**
   ```bash
   # 将本插件放入 AstrBot 的 plugins 目录
   ```

3. **重启 AstrBot**
   ```bash
   # 重启 AstrBot 以加载插件
   ```

### 基础配置

插件提供了灵活的配置选项，可通过 AstrBot 配置界面进行设置：

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `min_message_length` | 5 | 触发记忆处理的最小消息字符数 |
| `short_term_memory_capacity` | 1.0 | 短期记忆容量倍数（0.1-10.0） |
| `sleep_interval` | 3600 | 记忆巩固间隔，单位秒（0=禁用） |
| `provider_id` | "" | 记忆整理 LLM 提供商 ID |
| `small_model_note_budget` | 5000 | 潜意识模型 Token 预算 |
| `large_model_note_budget` | 50000 | 应答模型 Token 预算 |
| `astrbot_embedding_provider_id` | "" | 嵌入式模型提供商 ID |

### 高级配置建议

- **记忆系统优化**：
  - 设置 `provider_id` 启用智能记忆整理
  - 调整 `sleep_interval` 控制记忆优化频率
  - 根据使用场景调整 `short_term_memory_capacity`

- **知识库优化**：
  - 使用官方 API 提供商获得更好的向量化效果
  - 根据模型 Token 限制调整预算设置
  - 合理组织文件结构提高检索精度

## 📁 项目结构

```
astrbot_plugin_angel_memory/
├── core/                     # 核心记忆系统
│   ├── plugin_manager.py    # 插件管理器
│   ├── plugin_context.py    # 插件上下文
│   ├── deepmind.py          # 主记忆处理逻辑
│   └── config.py            # 配置管理
├── llm_memory/              # 记忆与知识库模块
│   ├── parser/             # 多格式文件解析器
│   ├── service/            # 记忆和笔记服务
│   └── components/         # 向量存储等组件
├── docs/                   # 文档和说明
├── tests/                  # 测试代码
├── main.py                 # 插件入口
├── metadata.yaml           # 插件元数据
└── requirements.txt        # 依赖列表
```

### 数据目录结构

插件运行后会在以下目录创建数据文件：

```
astrbot/data/plugin_data/astrbot_plugin_angel_memory/
├── raw/                    # 知识库文件存放目录
└── storage/               # 向量数据库和记忆存储
```

## 📚 知识库使用指南

### 文件组织最佳实践

**路径即标签**：文件夹层级和文件名都会成为检索关键词

推荐的知识库结构：

```
raw/
├── 技术文档/
│   ├── 编程语言/
│   │   ├── Python基础教程.md
│   │   └── JavaScript高级特性.md
│   ├── 框架库/
│   │   ├── React组件开发.md
│   │   └── Django项目实践.md
│   └── 工具使用/
│       ├── Git版本控制.md
│       └── Docker容器化.md
├── 业务知识/
│   ├── 产品设计/
│   ├── 市场分析/
│   └── 用户研究/
└── 个人笔记/
    ├── 学习记录/
    └── 项目总结/
```

### 文件格式建议

- **✅ 推荐格式**：
  - Markdown（最佳检索效果）
  - 纯文本文件
  - 结构化的 Word/PDF 文档

- **📝 命名规范**：
  - 使用描述性文件名
  - 避免特殊字符和空格
  - 保持文件名简洁有意义

- **📄 内容组织**：
  - 使用标题层级组织内容
  - 按主题拆分大型文档
  - 保持内容结构清晰

### 索引管理

**自动索引流程**：

1. **添加文件**：将文档放入 `raw/` 目录
2. **触发扫描**：重启插件自动扫描（每次重启完全重建索引）
3. **智能处理**：系统自动解析、向量化、建立索引
4. **即时生效**：对话时自动检索相关内容
5. **同步更新**：删除/修改文件后重启插件同步知识库

## 🚀 使用场景

### 1. 智能客服助手
- **记忆系统**：学习用户偏好和历史问题
- **知识库**：提供产品文档和FAQ支持
- **效果**：个性化的服务体验

### 2. 学习伴侣
- **记忆系统**：跟踪学习进度和薄弱环节
- **知识库**：提供学习资料和知识点解释
- **效果**：定制化的学习路径

### 3. 工作助手
- **记忆系统**：了解工作习惯和项目背景
- **知识库**：提供工作文档和参考资料
- **效果**：高效的工作支持

## 🔧 故障排除

### 常见问题

**Q: 插件启动失败？**
A: 检查是否已安装 `astrbot_plugin_angel_heart` 前置插件

**Q: 知识库检索无结果？**
A: 确保 `raw/` 目录中有文件，且已重启插件触发索引

**Q: 记忆系统不工作？**
A: 检查配置中的 `min_message_length` 设置，调整消息过滤阈值

**Q: 向量化速度慢？**
A: 考虑使用官方 API 提供商提高处理速度

### 性能优化建议

- **内存优化**：调整 `short_term_memory_capacity` 控制内存使用
- **响应速度**：合理设置 Token 预算，平衡质量与速度
- **索引效率**：保持知识库文件大小适中，避免单个文件过大

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进项目！

### 开发环境搭建

1. 克隆项目到本地
2. 安装依赖：`pip install -r requirements.txt`
3. 运行测试：`python -m pytest tests/`
4. 代码格式化：`ruff format .`

## 📄 许可证

本项目采用 [GNU General Public License v3.0](LICENSE)。

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和用户。

---

**让 AI 既有记忆，又有知识 - Angel Memory**
