# Angel Memory - 智能记忆与知识库系统

> 为 AstrBot 提供最先进的记忆维护系统和开箱即用的知识库检索能力

## 🌟 项目简介

Angel Memory 是一个基于双层认知架构的 AI 记忆系统插件，通过「记忆系统」和「知识库系统」的协同工作，让 AI 拥有自行运转的潜意识记忆和强大的知识检索能力。

### 核心特性

- **🧠 智能记忆系统**：自动学习对话经验，构建个性化记忆网络
- **📚 知识库检索**：支持 20+ 种文档格式，智能检索相关知识
- **🔄 双系统协同**：记忆提供经验，知识库提供信息，双重增强 AI 理解
- **⚡ 极速启动**：毫秒级启动，后台智能初始化
- **🔧 零配置使用**：开箱即用，自动索引和管理

## 🏗️ 系统架构

### 双层认知设计

```
用户输入
    ├── 记忆系统 (经验认知)
    │   ├── 对话历史分析
    │   ├── 用户偏好学习
    │   └── 记忆网络构建
    ├── 知识库系统 (知识检索)
    │   ├── 多格式文档解析
    │   ├── 智能内容检索
    │   └── 上下文提供
    └── 主模型推理 (综合决策)
```

### 记忆系统工作流

**四步认知循环**：观察 → 回忆 → 反馈 → 睡眠

1. **观察阶段**：监听对话，识别重要信息
2. **回忆阶段**：链式回忆相关记忆片段
3. **反馈阶段**：将有用记忆注入系统提示
4. **睡眠阶段**：定期整理和优化记忆网络

### 知识库系统特性

- **多格式支持**：PDF、Word、PPT、Excel、Markdown、文本等
- **智能解析**：自动提取文档结构和关键信息
- **语义检索**：基于内容语义的智能匹配
- **动态索引**：文件变化自动同步更新

## 📋 安装与配置

### ⚠️ 前置依赖要求

**必须安装 [astrbot_plugin_angel_heart](https://github.com/kawayiYokami/astrbot_plugin_angel_heart) 插件**

> AstrBot 原生聊天记录管理功能无法满足记忆系统需求，必须使用天使之心插件提供的增强聊天记录管理能力。

### 快速安装

1. **安装前置插件**
   ```bash
   # 在 AstrBot plugins 目录中安装天使之心插件
   ```

2. **安装记忆插件**
   ```bash
   # 将本插件放入 AstrBot 的 plugins 目录
   ```

3. **重启 AstrBot**
   ```bash
   # 重启 AstrBot 以加载插件
   ```

### 基础配置

插件提供了灵活的配置选项，可通过 AstrBot 配置界面进行设置：

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `min_message_length` | 5 | 触发记忆处理的最小消息字符数 |
| `short_term_memory_capacity` | 1.0 | 短期记忆容量倍数（0.1-10.0） |
| `sleep_interval` | 3600 | 记忆巩固间隔，单位秒（0=禁用） |
| `provider_id` | "" | 记忆整理 LLM 提供商 ID |
| `small_model_note_budget` | 5000 | 潜意识模型 Token 预算 |
| `large_model_note_budget` | 50000 | 应答模型 Token 预算 |
| `astrbot_embedding_provider_id` | "" | 嵌入式模型提供商 ID |

### 高级配置建议

- **记忆系统优化**：
  - 设置 `provider_id` 启用智能记忆整理
  - 调整 `sleep_interval` 控制记忆优化频率
  - 根据使用场景调整 `short_term_memory_capacity`

- **知识库优化**：
  - 使用官方 API 提供商获得更好的向量化效果
  - 根据模型 Token 限制调整预算设置
  - 合理组织文件结构提高检索精度

## 📁 项目结构

```
astrbot_plugin_angel_memory/
├── core/                     # 核心记忆系统
│   ├── plugin_manager.py    # 插件管理器
│   ├── plugin_context.py    # 插件上下文
│   ├── deepmind.py          # 主记忆处理逻辑
│   └── config.py            # 配置管理
├── llm_memory/              # 记忆与知识库模块
│   ├── parser/             # 多格式文件解析器
│   ├── service/            # 记忆和笔记服务
│   └── components/         # 向量存储等组件
├── docs/                   # 文档和说明
├── tests/                  # 测试代码
├── main.py                 # 插件入口
├── metadata.yaml           # 插件元数据
└── requirements.txt        # 依赖列表
```

### 数据目录结构

插件运行后会在以下目录创建数据文件：

```
astrbot/data/plugin_data/astrbot_plugin_angel_memory/
├── raw/                    # 知识库文件存放目录
└── storage/               # 向量数据库和记忆存储
```

## 📚 知识库使用指南

### 文件组织最佳实践

**路径即标签**：文件夹层级和文件名都会成为检索关键词

推荐的知识库结构：

```
raw/
├── 技术文档/
│   ├── 编程语言/
│   │   ├── Python基础教程.md
│   │   └── JavaScript高级特性.md
│   ├── 框架库/
│   │   ├── React组件开发.md
│   │   └── Django项目实践.md
│   └── 工具使用/
│       ├── Git版本控制.md
│       └── Docker容器化.md
├── 业务知识/
│   ├── 产品设计/
│   ├── 市场分析/
│   └── 用户研究/
└── 个人笔记/
    ├── 学习记录/
    └── 项目总结/
```

### 文件格式建议

- **✅ 推荐格式**：
  - Markdown（最佳检索效果）
  - 纯文本文件
  - 结构化的 Word/PDF 文档

- **📝 命名规范**：
  - 使用描述性文件名
  - 避免特殊字符和空格
  - 保持文件名简洁有意义

- **📄 内容组织**：
  - 使用标题层级组织内容
  - 按主题拆分大型文档
  - 保持内容结构清晰

### 索引管理

**自动索引流程**：

1. **添加文件**：将文档放入 `raw/` 目录
2. **触发扫描**：重启插件自动扫描（每次重启完全重建索引）
3. **智能处理**：系统自动解析、向量化、建立索引
4. **即时生效**：对话时自动检索相关内容
5. **同步更新**：删除/修改文件后重启插件同步知识库

## 🚀 使用场景

### 1. 智能客服助手
- **记忆系统**：学习用户偏好和历史问题
- **知识库**：提供产品文档和FAQ支持
- **效果**：个性化的服务体验

### 2. 学习伴侣
- **记忆系统**：跟踪学习进度和薄弱环节
- **知识库**：提供学习资料和知识点解释
- **效果**：定制化的学习路径

### 3. 工作助手
- **记忆系统**：了解工作习惯和项目背景
- **知识库**：提供工作文档和参考资料
- **效果**：高效的工作支持

## 🔧 故障排除

### 常见问题

**Q: 插件启动失败？**
A: 检查是否已安装 `astrbot_plugin_angel_heart` 前置插件

**Q: 知识库检索无结果？**
A: 确保 `raw/` 目录中有文件，且已重启插件触发索引

**Q: 记忆系统不工作？**
A: 检查配置中的 `min_message_length` 设置，调整消息过滤阈值

**Q: 向量化速度慢？**
A: 考虑使用官方 API 提供商提高处理速度

### 性能优化建议

- **内存优化**：调整 `short_term_memory_capacity` 控制内存使用
- **响应速度**：合理设置 Token 预算，平衡质量与速度
- **索引效率**：保持知识库文件大小适中，避免单个文件过大

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进项目！

### 开发环境搭建

1. 克隆项目到本地
2. 安装依赖：`pip install -r requirements.txt`
3. 运行测试：`python -m pytest tests/`
4. 代码格式化：`ruff format .`

## 📄 许可证

本项目采用 [MIT 许可证](LICENSE)。

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和用户。

---

**让 AI 既有记忆，又有知识 - Angel Memory**
